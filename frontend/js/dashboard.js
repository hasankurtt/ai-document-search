// Premium emoji collections - GENÄ°ÅžLETÄ°LMÄ°Åž
const emojiCollections = {
    education: [
        'ðŸ“š', 'ðŸ“–', 'ðŸ“', 'âœï¸', 'ðŸ“•', 'ðŸ“—', 'ðŸ“˜', 'ðŸ“™', 'ðŸ““', 'ðŸ“”',
        'ðŸŽ“', 'ðŸŽ¯', 'ðŸ“Š', 'ðŸ“ˆ', 'ðŸ“‰', 'ðŸ—‚ï¸', 'ðŸ“‹', 'ðŸ“Œ', 'ðŸ“', 'ðŸ”–',
        'ðŸ§®', 'ðŸ“', 'ðŸ“', 'âœ‚ï¸', 'ðŸ–Šï¸', 'ðŸ–ï¸', 'ðŸ–Œï¸', 'ðŸ”¬', 'ðŸ”­', 'âš—ï¸',
        'ðŸ“š', 'ï¿½ï¿½', 'ðŸŽ’', 'âœï¸', 'ðŸ“‘', 'ðŸ“„', 'ðŸ“ƒ', 'ðŸ—ƒï¸', 'ðŸ—„ï¸', 'ï¿½ï¿½'
    ],
    work: [
        'ðŸ’¼', 'ðŸ‘”', 'ðŸ’»', 'âŒ¨ï¸', 'ðŸ–¥ï¸', 'ðŸ“±', 'â˜Žï¸', 'ðŸ“ž', 'ðŸ“ ', 'ðŸ—ƒï¸',
        'ðŸ“‚', 'ðŸ“', 'ðŸ“„', 'ðŸ“ƒ', 'ðŸ“‘', 'ðŸ—’ï¸', 'ðŸ“‡', 'ðŸ“Š', 'ðŸ“ˆ', 'ðŸ“‰',
        'ðŸ’°', 'ðŸ’µ', 'ðŸ’´', 'ðŸ’¶', 'ðŸ’·', 'ðŸ’³', 'ðŸ¢', 'ðŸ¦', 'ðŸ­', 'âš–ï¸',
        'ðŸ”¨', 'ðŸ”§', 'âš™ï¸', 'ðŸ› ï¸', 'ðŸ“‹', 'ðŸ“Œ', 'ðŸ“', 'âœ…', 'ðŸ“', 'ðŸ—“ï¸'
    ],
    science: [
        'ðŸ”¬', 'ðŸ”­', 'âš—ï¸', 'ðŸ§ª', 'ðŸ§¬', 'ðŸ¦ ', 'ðŸ’‰', 'ðŸ©º', 'ðŸŒ¡ï¸', 'ðŸ§²',
        'âš›ï¸', 'ðŸ”†', 'ðŸ’¡', 'ðŸ”‹', 'ðŸ”Œ', 'ðŸ’»', 'ðŸ–¥ï¸', 'âš™ï¸', 'ðŸ› ï¸', 'ðŸ”§',
        'ðŸŒ', 'ðŸŒŽ', 'ðŸŒ', 'ðŸª', 'ðŸŒ™', 'â­', 'âœ¨', 'âš¡', 'ðŸ”¥', 'ðŸ’§',
        'ðŸ§«', 'ðŸ¦´', 'ðŸ§ ', 'ðŸ«€', 'ðŸ«', 'ðŸŒ‹', 'ðŸ”ï¸', 'ðŸŒŠ', 'â˜„ï¸', 'ðŸŒ '
    ],
    creative: [
        'ðŸŽ¨', 'ðŸ–Œï¸', 'ðŸ–ï¸', 'âœï¸', 'ï¿½ï¿½', 'ðŸŽ¬', 'ðŸŽª', 'ðŸŽ¸', 'ðŸŽ¹', 'ðŸŽº',
        'ðŸŽ»', 'ï¿½ï¿½', 'ðŸŽ¤', 'ðŸŽ§', 'ðŸ“»', 'ðŸ“·', 'ðŸ“¸', 'ðŸ“¹', 'ðŸŽ¥', 'ðŸ“½ï¸',
        'ðŸŽ®', 'ðŸŽ¯', 'ðŸŽ²', 'ðŸŽ°', 'ðŸŽ³', 'â™Ÿï¸', 'ðŸ§©', 'ðŸª€', 'ðŸª', 'ðŸŽˆ',
        'ðŸŽ‰', 'ðŸŽŠ', 'ðŸŽ', 'ðŸŽ€', 'ðŸ†', 'ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰', 'ðŸ…', 'ðŸŽ–ï¸'
    ],
    health: [
        'ðŸ¥', 'âš•ï¸', 'ðŸ©º', 'ðŸ’Š', 'ðŸ’‰', 'ï¿½ï¿½', 'ðŸ©¼', 'ðŸ¦·', 'ðŸ§¬', 'ðŸ”¬',
        'â¤ï¸', 'ðŸ«€', 'ï¿½ï¿½', 'ðŸ§ ', 'ðŸ¦´', 'ðŸ‘ï¸', 'ðŸ¦»', 'ðŸ‘ƒ', 'ðŸ‘„', 'ðŸ«‚',
        'ðŸƒ', 'ðŸš´', 'ðŸ‹ï¸', 'ðŸ¤¸', 'ðŸ§˜', 'ðŸ¥—', 'ðŸ¥¤', 'ï¿½ï¿½', 'ðŸ¥¦', 'ðŸ¥•',
        'ðŸ’ª', 'ðŸ§˜â€â™€ï¸', 'ðŸ§˜â€â™‚ï¸', 'ï¿½ï¿½', 'ðŸƒâ€â™€ï¸', 'ðŸƒâ€â™‚ï¸', 'ðŸ¤¾', 'â›¹ï¸', 'ðŸŠ', 'ðŸšµ'
    ],
    other: [
        'â­', 'âœ¨', 'ðŸ’«', 'ðŸŒŸ', 'âš¡', 'ðŸ”¥', 'ðŸ’¥', 'ðŸ’¢', 'ðŸ’¬', 'ðŸ’­',
        'ðŸŽ¯', 'ðŸŽª', 'ðŸŽ­', 'ðŸŽ¨', 'ðŸŽ¬', 'ðŸŽ®', 'ðŸŽ²', 'ðŸŽ°', 'ðŸŽ³', 'ðŸŽ¯',
        'ðŸŒˆ', 'â˜€ï¸', 'ðŸŒ™', 'â­', 'ðŸ’Ž', 'ðŸ”®', 'ðŸŽ', 'ðŸŽ€', 'ðŸŽŠ', 'ðŸŽ‰',
        'ðŸš€', 'ðŸ›¸', 'ðŸŒŒ', 'ðŸ”±', 'â™ ï¸', 'â™¥ï¸', 'â™¦ï¸', 'â™£ï¸', 'ðŸƒ', 'ðŸŽ´'
    ]
};

// All emojis flattened
const allEmojis = Object.values(emojiCollections).flat();

let selectedEmoji = 'ðŸ“š';
let currentCategory = 'all';

// Check authentication
function checkAuth() {
    const user = localStorage.getItem('user');
    const token = localStorage.getItem('token');
    
    if (!user || !token) {
        window.location.href = 'login.html';
        return false;
    }
    
    const userData = JSON.parse(user);
    document.getElementById('userName').textContent = userData.name;
    
    return true;
}

checkAuth();

// Logout
document.getElementById('logoutBtn').addEventListener('click', () => {
    localStorage.removeItem('user');
    localStorage.removeItem('token');
    window.location.href = 'login.html';
});

// Load rooms from localStorage
function loadRooms() {
    const rooms = JSON.parse(localStorage.getItem('chatRooms') || '[]');
    const roomsGrid = document.getElementById('roomsGrid');
    const emptyState = document.getElementById('emptyState');
    
    if (rooms.length === 0) {
        roomsGrid.innerHTML = '';
        emptyState.classList.remove('hidden');
        return;
    }
    
    emptyState.classList.add('hidden');
    
    roomsGrid.innerHTML = rooms.map(room => `
        <div class="room-card" onclick="openRoom('${room.id}')">
            <div class="room-card-header">
                <div class="room-card-emoji">${room.emoji}</div>
                <button class="room-menu-btn" onclick="event.stopPropagation(); showRoomMenu('${room.id}')">
                    â‹®
                </button>
            </div>
            <h3 class="room-card-title">${room.name}</h3>
            <p class="room-card-description">${room.description || 'AÃ§Ä±klama yok'}</p>
            <div class="room-card-stats">
                <div class="room-card-stat">
                    <span>ðŸ“„</span>
                    <span>${room.documents?.length || 0} dokÃ¼man</span>
                </div>
                <div class="room-card-stat">
                    <span>ðŸ’¬</span>
                    <span>${room.messages?.length || 0} mesaj</span>
                </div>
            </div>
            <div class="room-card-date">
                Son gÃ¼ncelleme: ${new Date(room.updatedAt).toLocaleDateString('tr-TR')}
            </div>
        </div>
    `).join('');
}

// Open room
function openRoom(roomId) {
    window.location.href = `room.html?id=${roomId}`;
}

// Create room modal
const createRoomModal = document.getElementById('createRoomModal');
const createRoomBtn = document.getElementById('createRoomBtn');
const createRoomForm = document.getElementById('createRoomForm');

createRoomBtn.addEventListener('click', () => {
    createRoomModal.classList.remove('hidden');
    selectedEmoji = 'ðŸ“š';
    document.getElementById('selectedEmojiDisplay').textContent = selectedEmoji;
    document.getElementById('roomEmoji').value = selectedEmoji;
});

function closeCreateRoomModal() {
    createRoomModal.classList.add('hidden');
    createRoomForm.reset();
    document.getElementById('emojiPickerContainer').classList.add('hidden');
    selectedEmoji = 'ðŸ“š';
}

// Toggle emoji picker
function toggleEmojiPicker() {
    const picker = document.getElementById('emojiPickerContainer');
    picker.classList.toggle('hidden');
    
    if (!picker.classList.contains('hidden')) {
        loadEmojiGrid('all');
        setupEmojiSearch();
        setupEmojiTabs();
    }
}

// Setup emoji tabs
function setupEmojiTabs() {
    const tabs = document.querySelectorAll('.emoji-tab');
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            tabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            const category = tab.getAttribute('data-category');
            loadEmojiGrid(category);
        });
    });
}

// Setup emoji search
function setupEmojiSearch() {
    const searchInput = document.getElementById('emojiSearch');
    searchInput.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase();
        if (query === '') {
            loadEmojiGrid(currentCategory);
        } else {
            filterEmojis(query);
        }
    });
}

// Filter emojis by search
function filterEmojis(query) {
    const grid = document.getElementById('emojiGrid');
    const filtered = allEmojis.filter(emoji => {
        // Simple filter - in real app you'd have emoji names/tags
        return true; // For now show all, you can add emoji names mapping
    });
    
    if (filtered.length === 0) {
        grid.innerHTML = '<p style="text-align: center; color: #64748b; padding: 2rem;">Emoji bulunamadÄ±</p>';
    } else {
        renderEmojis(filtered);
    }
}

// Load emoji grid
function loadEmojiGrid(category) {
    currentCategory = category;
    const emojis = category === 'all' ? allEmojis : emojiCollections[category] || allEmojis;
    renderEmojis(emojis);
}

// Render emojis
function renderEmojis(emojis) {
    const grid = document.getElementById('emojiGrid');
    grid.innerHTML = emojis.map(emoji => `
        <button type="button" class="emoji-item ${emoji === selectedEmoji ? 'selected' : ''}" data-emoji="${emoji}">
            ${emoji}
        </button>
    `).join('');
    
    // Add click listeners
    grid.querySelectorAll('.emoji-item').forEach(btn => {
        btn.addEventListener('click', () => {
            selectedEmoji = btn.getAttribute('data-emoji');
            document.getElementById('selectedEmojiDisplay').textContent = selectedEmoji;
            document.getElementById('roomEmoji').value = selectedEmoji;
            
            // Update selected state
            grid.querySelectorAll('.emoji-item').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            
            // Close picker
            setTimeout(() => {
                document.getElementById('emojiPickerContainer').classList.add('hidden');
            }, 200);
        });
    });
}

// Create room form submit
createRoomForm.addEventListener('submit', (e) => {
    e.preventDefault();
    
    const name = document.getElementById('roomName').value;
    const description = document.getElementById('roomDescription').value;
    const emoji = selectedEmoji;
    
    const rooms = JSON.parse(localStorage.getItem('chatRooms') || '[]');
    
    const newRoom = {
        id: Date.now().toString(),
        name,
        description,
        emoji,
        documents: [],
        messages: [],
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    };
    
    rooms.push(newRoom);
    localStorage.setItem('chatRooms', JSON.stringify(rooms));
    
    closeCreateRoomModal();
    loadRooms();
});

// Room menu
function showRoomMenu(roomId) {
    const confirmed = confirm('Bu odayÄ± silmek istiyor musunuz?');
    if (confirmed) {
        deleteRoom(roomId);
    }
}

function deleteRoom(roomId) {
    const rooms = JSON.parse(localStorage.getItem('chatRooms') || '[]');
    const filteredRooms = rooms.filter(room => room.id !== roomId);
    localStorage.setItem('chatRooms', JSON.stringify(filteredRooms));
    loadRooms();
}

// Initial load
loadRooms();
